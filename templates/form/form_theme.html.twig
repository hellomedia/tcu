{% use "form_div_layout.html.twig" %}

{% block form_row %}
    {%- set row_attr = row_attr|merge({'class': ('form-row' ~ ' ' ~ row_attr.class|default(''))|trim}) -%}
    {{ parent() }}
{% endblock %}

{%- block choice_widget_expanded -%}
    <div {{ block('widget_container_attributes') }}>
        {%- for child in form %}
            <div class="choice-expanded-item">
                <label class="{{ multiple ? 'checkbox' : 'radio' }} {{ child.vars.checked ? 'checked' }}">
                    {{ form_widget(child) }}
                    <span class="{{ multiple ? 'custom-checkbox' : 'custom-radio' }}"></span>
                    <span class="label">{{- child.vars.label|trans -}}</span>
                </label>
            </div>
        {% endfor -%}
    </div>
{%- endblock choice_widget_expanded -%}

{%- block checkbox_row -%}
    {%- set row_attr = row_attr|merge({'class': ('form-row' ~ ' ' ~ row_attr.class|default(''))|trim}) -%}
    {% if attr['data-switch'] is defined and attr['data-switch'] %}
        <div {% with {attr: row_attr} %}{{ block('attributes') }}{% endwith %}>
            {{- block('checkbox_widget_switch') -}}
            {{- form_errors(form) -}}
            {# help text #}
            {% if help is not empty %}
                <div class="form-help">{{ help|trans }}</div>
            {% endif %}
        </div>
    {% else %}
        <div {% with {attr: row_attr} %}{{ block('attributes') }}{% endwith %}>
            <label class="checkbox {{ checked ? 'checked' }}">
                {{ form_widget(form) }}
                <span class="custom-checkbox"></span>
                <span class="label">{{- label|trans -}}</span>
            </label>
        </div>
    {% endif %}
{%- endblock checkbox_row -%}

{# Custom widget for the switch: input immediately followed by its label #}
{% block checkbox_widget_switch %}
    {# Keep native checkbox for a11y; we'll hide it visually #}
    <input type="checkbox"
           {{ block('widget_attributes') }}
           {% if value is not same as(false) %} value="{{ value }}"{% endif %}
           {% if checked %} checked="checked"{% endif %}
    />
    <label for="{{ id }}" class="switch-label">
        <span class="switch-track" aria-hidden="true">
            <span class="switch-thumb"></span>
        </span>
        <span class="switch-text">{{ label is same as(false) ? '' : (label|trans(label_translation_parameters, translation_domain)) }}</span>
    </label>
{% endblock %}

{% block textarea_widget %}
    {%- set attr = attr|merge({
        'data-controller': ('autogrow' ~ ' ' ~ attr['data-controller']|default(''))|trim,
        'data-action': ('input->autogrow#resize' ~ ' ' ~ attr['data-action']|default(''))|trim,
    }) 
    -%}
	{{ parent() }}
{% endblock %}

{%- block form_errors -%}
    {%- if errors|length > 0 -%}
        <ul class="form-errors">
            {%- for error in errors -%}
                <li>{{ error.message }}</li>
            {%- endfor -%}
        </ul>
    {%- endif -%}
{%- endblock form_errors -%}

{# Button: Add loader #}
{# see loading-button_controller.js and loading-btn.css #}
{% block button_widget %}
	{% set attr = attr|merge({'data-controller': 'loading', 
                              'data-loading-target': 'button', 
                              'class': (attr.class|default('') ~ ' ' ~ 'btn')|trim }) %}

	<button {{ block('button_attributes') }} type="{{ type|default('submit') }}">
		<span>{{ label|default('Save') }}</span>
		<div class="loader" data-loading-target="loader">
			<div class="spinner"></div>
		</div>
	</button>
{% endblock %}





